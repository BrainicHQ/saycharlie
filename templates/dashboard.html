{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block extra_head %}
    <!-- Include Kioskboard script -->
    <script src="https://cdn.jsdelivr.net/npm/kioskboard@2.3.0/dist/kioskboard-aio-2.3.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/kioskboard@2.3.0/dist/kioskboard-2.3.0.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.16.0/tingle.min.js"
            integrity="sha512-2B9/byNV1KKRm5nQ2RLViPFD6U4dUjDGwuW1GU+ImJh8YinPU9Zlq1GzdTMO+G2ROrB5o1qasJBy1ttYz0wCug=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.16.0/tingle.min.css"
          integrity="sha512-b+T2i3P45i1LZM7I00Ci5QquB9szqaxu+uuk5TUSGjZQ4w4n+qujQiIuvTv2BxE7WCGQCifNMksyKILDiHzsOg=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"
            integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO"
            crossorigin="anonymous"></script>
{% endblock %}
{% block content %}
    <div id="lastTalker" class="bg-gray-100 border border-gray-300 p-3 rounded-md">Last Talker: Loading...</div>
    <div id="talkerTimer" class="bg-gray-100 border border-gray-300 p-3 rounded-md">Talk Duration: 0 min 0 sec</div>
    <!-- An example of a textarea element: The keyboard type is "all", the placement is "top", and the availability of the special characters is "true". -->
    <button class="text-white bg-gradient-to-br from-purple-600 to-blue-500 hover:bg-gradient-to-bl focus:ring-4
    focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2"
            onclick="modal.open()">Send custom DTMF
    </button>
    <!-- Display category buttons -->
    {% for button in buttons %}
        {% if button.isCategory %}
            <a href="category?name={{ button.encoded_label }}" data-category-label="{{ button.label }}"
               class="bg-[{{ button.color }}] text-white text-lg font-semibold p-2 rounded-md">{{ button.label }}</a>
        {% endif %}
    {% endfor %}
    <!-- Display standalone buttons -->
    {% for button in buttons %}
        {% if not button.isCategory and not button.category %}
            <button onclick="sendDTMF('{{ button.action }}')"
                    class="bg-[{{ button.color }}] text-white text-lg font-semibold p-2 rounded-md">{{ button.label }}</button>
        {% endif %}
    {% endfor %}
    <div class="mt-8">
        <button id="startButton" class="bg-blue-500 text-white px-4 py-2 rounded-md">Start Measuring</button>
        <br>
        <div class="grid grid-cols-2 gap-4 mt-4">
            <div class="relative">
                <meter id="meter" high="0.25" max="0.2" value="0"
                       class="w-full h-12 bg-accent text-white rounded-md"
                       low="0.15" optimum="0.5"></meter>
                <div id="dBLabel"
                     class="absolute top-0 left-0 w-full h-full flex items-center justify-center text-xs text-gray-500">
                    0 dB
                </div>
            </div>
        </div>
    </div>
    <script>
        function sendDTMF(dtmf_code) {
            fetch('/api/send_dtmf', {
                method: 'POST',
                body: JSON.stringify({dtmf_code: dtmf_code}),
                headers: {
                    'Content-Type': 'application/json',
                },
            }).then(response => {
                if (response.ok) {
                    console.log('DTMF ' + dtmf_code + ' sent successfully');
                    alert('DTMF ' + dtmf_code + ' sent successfully');
                } else {
                    console.error('Failed to send DTMF');
                    alert('Failed to send DTMF: ' + response.statusText);
                }
            });
        }
    </script>
    <script src="{{ url_for('static', filename='js/ham-api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/meter.js') }}"></script>
    <script src="{{ url_for('static', filename='js/talker.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/keyboard.js') }}"></script>
{% endblock %}